// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../src/generated"
}

datasource db {
  provider     = "mysql"
  url          = env("DATABASE_URL")
  relationMode = "prisma"
}

model User {
  id                  String             @id @default(cuid())
  nom                 String
  prenom              String
  email               String             @unique
  telephone           String
  mot_de_passe        String
  role                Role
  avatar              String?            @db.VarChar(255)
  adresse             String?            @db.Text
  localisation        String?            @db.VarChar(100)
  latitude            Decimal?           @db.Decimal(10, 8)
  longitude           Decimal?           @db.Decimal(11, 8)
  statut              Statut             @default(actif)
  createdAt           DateTime           @default(now())
  updatedAt           DateTime           @updatedAt

  produits            Produit[]
  commandesCollecteur Commande[]        


  @@index([role])
  @@index([localisation])
}

enum Statut {
  actif
  inactif
  suspendu
}

enum Role {
  paysan
  collecteur
  admin
}

model Produit {
  id                 String             @id @default(cuid())
  nom                String             @db.VarChar(150)
  type               ProduitType
  sousType           String?            @db.VarChar(100)
  description        String?
  quantiteDisponible Decimal            @db.Decimal(10, 2)
  unite              Unite              @default(kg)
  prixUnitaire       Decimal            @db.Decimal(10, 2)
  dateRecolte        DateTime
  datePeremption     DateTime?
  imageUrl           String?            @db.VarChar(255)
  statut             ProduitStatut      @default(disponible)
  conditionsStockage String?

  createdAt          DateTime           @default(now())
  updatedAt          DateTime           @updatedAt

  commandesProduit   CommandeProduit[]

  paysanId           String
  paysan             User              @relation(fields: [paysanId], references: [id], onDelete: Cascade)


  @@index([paysanId])
  @@index([type])
  @@index([statut])
  @@index([dateRecolte])
}

// Enum pour le type de produit
enum ProduitType {
  grain
  legumineuse
  tubercule
  fruit
  legume
  epice
  autre
}

// Enum pour l’unité
enum Unite {
  kg
  tonne
  sac
  litre
}

// Enum pour le statut
enum ProduitStatut {
  disponible
  rupture
  archive
}



model Commande {
  id                String             @id @default(cuid())
  produitRecherche  String
  quantiteTotal     Decimal            @db.Decimal(10,2)
  prixUnitaire      Decimal            @db.Decimal(10,2)
  territoire        String?
  statut            CommandeStatut     @default(ouverte)
  messageCollecteur String?
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt

  collecteurId      String
  collecteur        User              @relation(fields: [collecteurId], references: [id])

  lignes            CommandeProduit[]
}



// ENUMs
enum CommandeStatut {
  en_attente
  ouverte
  partiellement_fournie
  complete
  acceptee
  annulee
}



model CommandeProduit {
  id               String       @id @default(cuid())
  quantiteAccordee Decimal      @db.Decimal(10,2)
  prixUnitaire     Decimal      @db.Decimal(10,2)
  statutLigne      StatutLigne  @default(acceptee)
  createdAt        DateTime     @default(now())
  updatedAt        DateTime     @updatedAt

  commandeId       String
  commande         Commande    @relation(fields: [commandeId], references: [id])
  produitId        String
  produit          Produit     @relation(fields: [produitId], references: [id])
}

// ENUM
enum StatutLigne {
  acceptee
  partiellement_acceptee
  rejetée
}

